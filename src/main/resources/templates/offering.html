<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="stylesheet" href="css/logowanie.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <title>Przekazywanie uprawnień</title>
</head>
<body >
    <div class="container dashboard">
        <h2>Moduł przekazywania uprawnień</h2>
        <h4 th:text="'Aktywny użytkownik: '+${username}"/>
        <h4>
            <form style="display: inline" action="/" method="get">
                <button type="submit" class="btn btn-md btn-primary">Zarządzaj danymi</button>
            </form>
            <form method="post" th:action="@{/logout}">
                <input type="hidden"
                       th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}"/>
                <button type="submit" class="btn btn-md btn-warning">Wyloguj</button>
            </form>
        </h4>
        <div class="panel panel-default main dashboard" style="padding-left: 12px; padding-top: 0px">
            <div class="row space-for-div">
                <div class="col-md-4" ></div>
                <div class="col-md-4">
                    <button style="display: inline" type="button" class="btn btn-sq btn-block btn-space"

                            th:onclick="|changeGrantMode('grant')|"
                            th:classappend="${grantMode == 'grant'}? btn-info: none">Przekaż</button>
                    <button style="display: inline" class="btn btn-sq btn-block btn-space"
                            th:onclick="|changeGrantMode('give')|"
                            th:classappend="${grantMode == 'give'}? btn-info: none">Oddaj</button>
                </div>
                <div class="col-md-4"></div>
            </div>

            <div class="row space-for-div"  >
                <div class="col-md-7" >
                    <div class="divTable" th:with=" privilegesList = ${privilegeInfo.getColumnNamesInDb()}" >
                        <div class="divTableHeading" >
                            <div class="divTableHead"
                                 th:text="Tabele"></div>
                            <div class="divTableHead"
                                 th:each=" privilege: ${privilegesList}"
                                 th:text="${privilege}"
                                 th:if="${privilege} != 'id'">
                            </div>
                        </div>
                        <div class="divTableBody">
                            <div class="divTableRow"
                                 th:each="tableDBName : ${grantedPrivilegeInfo.getColumnNamesInDb()}">
                                <div class="divTableName" th:text="${tableDBName}"></div>
                                <div class="divPrivilege"  th:each="privilege: ${privilegesList}" th:if="${privilege} != 'id'">
                                    <select class=" list yellow rounded" th:id ="${tableName} + ${privilege}">
                                        <option>Nie przekazuj</option>
                                        <option>Z delegacją</option>
                                        <option>Bez delegacji</option>
                                    </select>
                                    <h6 th:text="${getterName}"></h6>
                                </div>
                            </div>
                        </div>

                    </div>
                    <button type="submit" class="btn btn-default right">Zatwierdź</button>
                </div>
                <div class="col-lg-1" > </div>
                <div class="col-md-3" >
                    <h5>Wybierz użytkownika</h5>
                    <select class=" list yellow rounded" id="chosenUser">
                        <option th:each="user : ${users}" th:text="${user}"></option>
                    </select>
                </div>
                <div class="col-lg-1" > </div>
            </div>
            <div class="row space-for-div"  >
                <div class="col-md-9"></div>
                <div class="col-md-2">

                    <button type="button" class="btn btn-sq btn-block btn-space btn-info" th:text="Wyślij">
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        function changeGrantMode(mode) {
            var token = $("meta[name='_csrf']").attr("content");
            //$('body').load("/offering?grantMode=" + mode);
            $.ajax({
                url: "/offering?grantMode=" + mode,
                headers: {'X-CSRF-TOKEN': token},
                type: "GET"
            }).done(function (data) {
                $('body').html(data);
            });
        }
        /*]]>*/
    </script>
</body>
</html>